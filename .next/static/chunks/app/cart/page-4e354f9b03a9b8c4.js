(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[565],{1978:function(e,t,a){Promise.resolve().then(a.bind(a,1103))},1103:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var s=a(7437),r=a(2265),l=a(9376),i=a(2869),n=a(6070),c=a(2449),d=a(2660),o=a(1047),m=a(1734),x=a(8930),u=a(9397),p=a(4196),f=a(8349);let h=(0,a(6580).eI)("https://scxpgzgxqgjnrvfybcyc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjeHBnemd4cWdqbnJ2ZnliY3ljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NDk0NjgsImV4cCI6MjA2NzMyNTQ2OH0.l84EQBLql2WKQoRTD-0CPsLtOF5bVEdmS6IYmrKzwmg");var g=e=>{let{cartItems:t}=e,[a,l]=(0,r.useState)(""),[i,n]=(0,r.useState)(""),[c,d]=(0,r.useState)(""),[o,m]=(0,r.useState)(""),[x,u]=(0,r.useState)(""),[p,f]=(0,r.useState)(!1),[g,j]=(0,r.useState)(!1),[b,v]=(0,r.useState)(!1),[N,y]=(0,r.useState)(!1),[w,C]=(0,r.useState)({}),S=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),k=e=>/^\+?\d{7,15}$/.test(e);(0,r.useEffect)(()=>{(async()=>{var e;let t=await h.auth.getUser();(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.user)&&n(t.data.user.email||"")})()},[]);let D=async()=>{if(!S(i)){C(e=>({...e,email:"Enter a valid email to get OTP."}));return}v(!0),f(!0),await h.from("otps").delete().eq("email",i);let e=Math.floor(1e5+9e5*Math.random()).toString(),{error:t}=await h.from("otps").insert({email:i,code:e});t?(console.error(t),alert("Error sending OTP. Try again.")):alert("✅ OTP sent! (Dev: ".concat(e,")")),v(!1)},q=async()=>{if(!x){alert("Enter OTP first.");return}y(!0);let{data:e,error:t}=await h.from("otps").select("*").eq("email",i).eq("code",x).gte("created_at",new Date(Date.now()-6e5).toISOString()).single();t||!e?alert("❌ Invalid/Expired OTP."):(await h.from("otps").delete().eq("id",e.id),j(!0),alert("✅ Email verified!")),y(!1)},I=async e=>{e.preventDefault();let s={};if(a.trim()||(s.name="Name is required."),S(i)||(s.email="Invalid email."),k(c)||(s.phone="Invalid phone."),o.trim()||(s.address="Address required."),g||(s.otp="Please verify email before order."),C(s),Object.keys(s).length>0)return;let r=t.map(e=>({product_id:e.product.id,product_name:e.product.name,variant_id:e.variant.id,variant_quantity:e.variant.quantity,unit_price:e.variant.price,quantity:e.quantity,total_price:e.variant.price*e.quantity})),{error:l}=await h.from("orders").insert({name:a,email:i,phone:c,address:o,product_details:r,total_price:r.reduce((e,t)=>e+t.total_price,0)});l?(console.error(l),alert("❌ Failed to place order.")):alert("✅ Order placed & saved!")};return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#f9f5ef] px-4 sm:px-2",children:(0,s.jsxs)("form",{onSubmit:I,className:"w-full max-w-md bg-white shadow-md rounded-lg p-6 space-y-4",autoComplete:"on",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2 text-center",children:"Checkout"}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm mb-1",children:"Full Name"}),(0,s.jsx)("input",{type:"text",autoComplete:"name",value:a,onChange:e=>l(e.target.value),className:"border rounded px-3 py-2 focus:ring text-sm ".concat(w.name?"border-red-500":"border-gray-300 focus:ring-[#2f7a4d]"),placeholder:"John Doe"}),w.name&&(0,s.jsx)("p",{className:"text-red-600 text-xs",children:w.name})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm mb-1",children:"Email"}),(0,s.jsxs)("div",{className:"flex gap-2 flex-col sm:flex-row",children:[(0,s.jsx)("input",{type:"email",autoComplete:"email",value:i,onChange:e=>n(e.target.value),className:"flex-1 border rounded px-3 py-2 focus:ring text-sm ".concat(w.email?"border-red-500":"border-gray-300 focus:ring-[#2f7a4d]"),placeholder:"john@example.com"}),(0,s.jsx)("button",{type:"button",onClick:D,disabled:b,className:"bg-[#2f7a4d] text-white px-4 py-2 rounded hover:bg-[#245a3a] text-sm",children:b?"Sending...":"Send OTP"})]}),w.email&&(0,s.jsx)("p",{className:"text-red-600 text-xs",children:w.email})]}),p&&(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm mb-1",children:"OTP"}),(0,s.jsxs)("div",{className:"flex gap-2 flex-col sm:flex-row",children:[(0,s.jsx)("input",{type:"text",inputMode:"numeric",autoComplete:"one-time-code",value:x,onChange:e=>u(e.target.value),placeholder:"123456",className:"flex-1 border border-gray-300 rounded px-3 py-2 focus:ring focus:ring-[#2f7a4d] text-sm"}),(0,s.jsx)("button",{type:"button",onClick:q,disabled:g||N,className:"bg-[#2f7a4d] text-white px-4 py-2 rounded hover:bg-[#245a3a] text-sm",children:g?"Verified":N?"Verifying...":"Verify"})]}),w.otp&&(0,s.jsx)("p",{className:"text-red-600 text-xs",children:w.otp})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm mb-1",children:"Phone"}),(0,s.jsx)("input",{type:"tel",autoComplete:"tel",value:c,onChange:e=>d(e.target.value),className:"border rounded px-3 py-2 focus:ring text-sm ".concat(w.phone?"border-red-500":"border-gray-300 focus:ring-[#2f7a4d]"),placeholder:"+91 1234567890"}),w.phone&&(0,s.jsx)("p",{className:"text-red-600 text-xs",children:w.phone})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm mb-1",children:"Address"}),(0,s.jsx)("textarea",{autoComplete:"street-address",value:o,onChange:e=>m(e.target.value),className:"border rounded px-3 py-2 focus:ring text-sm ".concat(w.address?"border-red-500":"border-gray-300 focus:ring-[#2f7a4d]"),placeholder:"Street, City, State, Postal Code"}),w.address&&(0,s.jsx)("p",{className:"text-red-600 text-xs",children:w.address})]}),(0,s.jsx)("button",{type:"submit",className:"w-full bg-[#2f7a4d] text-white py-3 rounded-md font-semibold hover:bg-[#245a3a] transition-all text-sm",children:"Place Order"})]})})};function j(){let e=(0,l.useRouter)(),{state:t,removeFromCart:a,updateQuantity:j,clearCart:b}=(0,u.j)(),[v,N]=(0,r.useState)(!1),[y,w]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{let{error:e}=await h.from("products").select("id").limit(1);e?console.error("❌ Supabase connection failed:",e.message):console.log("✅ Supabase connected!")})()},[]);let C=async()=>{N(!0);try{for(let e of t.items){let{data:t,error:a}=await h.from("products").select("id").eq("id",e.product.id).single();if(a||!t){alert('❌ Product "'.concat(e.product.name,'" is no longer available.')),N(!1);return}let{data:s,error:r}=await h.from("variants").select("price, original_price, in_stock").eq("id",e.variant.id).eq("product_id",e.product.id).single();if(r||!s){alert('❌ Variant "'.concat(e.variant.quantity,'" for ').concat(e.product.name," is missing.")),N(!1);return}if(s.price!==e.variant.price){alert('⚠️ Price for "'.concat(e.product.name,'" (').concat(e.variant.quantity,") has changed.")),N(!1);return}if(!s.in_stock){alert('❌ "'.concat(e.product.name,'" (').concat(e.variant.quantity,") is out of stock.")),N(!1);return}}w(!0)}catch(e){console.error("Checkout error:",e),alert("❌ Something went wrong during checkout.")}N(!1)};return 0===t.items.length?(0,s.jsxs)("div",{className:"min-h-screen bg-[#F9F1E6]",children:[(0,s.jsx)(p.default,{}),(0,s.jsx)("main",{className:"max-w-7xl mx-auto px-4 py-16",children:(0,s.jsxs)("div",{className:"text-center animate-fade-in",children:[(0,s.jsx)(c.Z,{className:"h-24 w-24 text-gray-400 mx-auto mb-6"}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Your cart is empty"}),(0,s.jsx)("p",{className:"text-gray-600 mb-8",children:"Add some delicious A2 Ghee products to get started!"}),(0,s.jsx)(i.z,{onClick:()=>e.push("/"),className:"bg-[#5D4733] hover:bg-[#7A3E2F] text-white px-8 py-3 rounded-full",children:"Continue Shopping"})]})}),(0,s.jsx)(f.default,{})]}):(0,s.jsxs)("div",{className:"relative min-h-screen bg-[#F9F1E6] ".concat(y?"overflow-hidden":""),children:[(0,s.jsx)(p.default,{}),(0,s.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-8 ".concat(y?"blur-sm pointer-events-none select-none":""),children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,s.jsxs)(i.z,{variant:"ghost",onClick:()=>e.push("/"),className:"text-[#5D4733] hover:bg-[#5D4733]/10",children:[(0,s.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Continue Shopping"]}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"Shopping Cart"})]}),(0,s.jsx)(i.z,{variant:"outline",onClick:b,className:"text-red-600 border-red-600 hover:bg-red-50 w-full sm:w-auto",children:"Clear Cart"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,s.jsx)("div",{className:"lg:col-span-2 space-y-4",children:t.items.map(e=>(0,s.jsx)(n.Zb,{className:"animate-fade-in hover-lift",children:(0,s.jsx)(n.aY,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[(0,s.jsx)("img",{src:e.product.image,alt:e.product.name,className:"w-20 h-20 object-cover rounded-lg"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-semibold text-lg text-gray-800",children:e.product.name}),(0,s.jsxs)("p",{className:"text-gray-600",children:[e.quantity," x ",e.variant.quantity]}),(0,s.jsxs)("p",{className:"text-[#5D4733] font-bold text-lg",children:["₹",e.variant.price]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.z,{variant:"outline",size:"icon",onClick:()=>j(e.product.id,e.variant.id,e.quantity-1),className:"border-[#5D4733] text-[#5D4733] hover:bg-[#5D4733] hover:text-white",children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})}),(0,s.jsx)("span",{className:"text-lg font-semibold w-8 text-center",children:e.quantity}),(0,s.jsx)(i.z,{variant:"outline",size:"icon",onClick:()=>j(e.product.id,e.variant.id,e.quantity+1),className:"border-[#5D4733] text-[#5D4733] hover:bg-[#5D4733] hover:text-white",children:(0,s.jsx)(m.Z,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"text-right mt-2 sm:mt-0",children:[(0,s.jsxs)("p",{className:"text-lg font-bold text-gray-800",children:["₹",e.variant.price*e.quantity]}),(0,s.jsx)(i.z,{variant:"ghost",size:"icon",onClick:()=>a(e.product.id,e.variant.id),className:"text-red-600 hover:bg-red-50 mt-2",children:(0,s.jsx)(x.Z,{className:"h-4 w-4"})})]})]})})},"".concat(e.product.id,"-").concat(e.variant.id)))}),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsx)(n.Zb,{className:"lg:sticky top-4 animate-fade-in w-full",children:(0,s.jsxs)(n.aY,{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Order Summary"}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{className:"text-gray-600",children:["Items (",t.itemCount,")"]}),(0,s.jsxs)("span",{className:"font-semibold",children:["₹",t.total]})]}),(0,s.jsx)("div",{className:"border-t pt-3",children:(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-lg font-bold",children:"Total"}),(0,s.jsxs)("span",{className:"text-lg font-bold text-[#5D4733]",children:["₹",t.total]})]})})]}),(0,s.jsx)(i.z,{onClick:C,disabled:v,className:"w-full bg-[#5D4733] hover:bg-[#7A3E2F] text-white py-3 rounded-full transition-all duration-300 transform hover:scale-105",children:v?"Processing...":"Proceed to Checkout"}),(0,s.jsxs)("div",{className:"mt-4 text-center text-sm text-gray-500",children:[(0,s.jsx)("p",{children:"\uD83D\uDD12 Secure checkout"}),(0,s.jsx)("p",{children:"\uD83D\uDCE6 Free delivery on all orders"})]})]})})})]})]}),y&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,s.jsx)("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:(0,s.jsx)(g,{cartItems:t.items})})}),(0,s.jsx)(f.default,{})]})}},6070:function(e,t,a){"use strict";a.d(t,{Zb:function(){return i},aY:function(){return n}});var s=a(7437),r=a(2265),l=a(4508);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});i.displayName="Card",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...r})}).displayName="CardHeader",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h3",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})}).displayName="CardTitle",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...r})}).displayName="CardDescription";let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...r})});n.displayName="CardContent",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter"}},function(e){e.O(0,[590,540,196,349,971,117,744],function(){return e(e.s=1978)}),_N_E=e.O()}]);